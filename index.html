<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> Manicure PRO</title>

<link rel="manifest" href="manifest.json">

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#fdf2f8,#fbcfe8);
}

/* HEADER */
.header{
background:#ec4899;
color:white;
padding:25px;
text-align:center;
}

/* CONTENEDOR */
.container{
max-width:1100px;
margin:auto;
padding:20px;
}

.card{
background:white;
padding:20px;
border-radius:20px;
box-shadow:0 10px 25px rgba(0,0,0,0.08);
margin-bottom:20px;
animation: fadeIn 0.4s ease;
transition: transform 0.2s;
}

.card:hover{
transform:translateY(-3px);
}

.topbar{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:15px;
}

button{
padding:8px 12px;
border:none;
border-radius:10px;
background:#ec4899;
color:white;
cursor:pointer;
margin:3px;
transition:all 0.2s ease;
}

button:hover{background:#db2777;}
button:active{transform:scale(0.95);}

input{
padding:8px;
border-radius:8px;
border:1px solid #ddd;
margin-bottom:8px;
width:100%;
}

.calendar{
display:grid;
grid-template-columns:repeat(7,1fr);
gap:8px;
}

.day{
padding:12px;
border-radius:10px;
text-align:center;
font-weight:bold;
cursor:pointer;
}

.disponible-dia{background:#bbf7d0;}
.parcial-dia{background:#fbcfe8;}
.lleno-dia{background:#f87171;color:white;}
.bloqueado-dia{background:#444;color:white;}

.horas{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:6px;
margin-top:10px;
}

.hora-btn{
padding:6px;
border-radius:8px;
border:none;
}

.disponible{background:#fbcfe8;}
.ocupado{background:#ddd;cursor:not-allowed;}

.hidden{display:none;}
.admin-delete{background:#ef4444;}
.stat-box{
background:#fdf2f8;
padding:10px;
border-radius:10px;
margin-bottom:8px;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(10px);}
to{opacity:1;transform:translateY(0);}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginView" class="card" style="max-width:400px;margin:80px auto;">
<h2>Ingreso</h2>
<input type="text" id="usuario" placeholder="Usuario">
<input type="password" id="clave" placeholder="Contrase√±a">
<button onclick="login()">Ingresar</button>

<h3>Crear Cuenta</h3>
<input type="text" id="nuevoUsuario" placeholder="Nombre completo">
<input type="password" id="nuevaClave" placeholder="Contrase√±a">
<button onclick="registrar()">Registrarse</button>
</div>

<!-- APP -->
<div id="appView" class="hidden">

<div class="header">
<p>Agenda Profesional PRO+ üíÖ</p>
</div>

<div class="container">

<div class="topbar">
<h3 id="rolTitulo"></h3>
<button onclick="logout()">Salir</button>
</div>

<div class="card">
<div class="topbar">
<button onclick="cambiarMes(-1)">‚Üê</button>
<h3 id="mesActual"></h3>
<button onclick="cambiarMes(1)">‚Üí</button>
</div>
<div class="calendar" id="calendar"></div>
</div>

<div id="clientePanel" class="card hidden"></div>

<div id="adminPanel" class="hidden">

<div class="card">
<h3>Estad√≠sticas del mes</h3>
<div id="estadisticas"></div>
<button onclick="exportarPDF()">Exportar PDF</button>
</div>

<div class="card">
<h3>Reservas</h3>
<ul id="listaAdmin"></ul>
</div>

</div>

</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let usuarios=JSON.parse(localStorage.getItem("usuarios"))||[
{usuario:"admin",clave:"1234",rol:"admin"}
];

let reservas=JSON.parse(localStorage.getItem("reservas"))||[];
let sesion=null;
let fechaActual=new Date();
let precioBase=15000;

function registrar(){
const usuario=document.getElementById("nuevoUsuario").value;
const clave=document.getElementById("nuevaClave").value;
if(!usuario||!clave)return alert("Completa datos");
usuarios.push({usuario,clave,rol:"cliente"});
localStorage.setItem("usuarios",JSON.stringify(usuarios));
alert("Cuenta creada üíÖ");
}

function login(){
const u=document.getElementById("usuario").value;
const c=document.getElementById("clave").value;
const user=usuarios.find(x=>x.usuario===u&&x.clave===c);
if(!user)return alert("Datos incorrectos");
sesion=user;
document.getElementById("loginView").classList.add("hidden");
document.getElementById("appView").classList.remove("hidden");
document.getElementById("rolTitulo").textContent=
user.rol==="admin"?"Panel Administrador":"Panel Cliente";
generarCalendario();
if(user.rol==="admin"){
document.getElementById("adminPanel").classList.remove("hidden");
mostrarReservasAdmin();
estadisticas();
}
}

function logout(){location.reload();}

/* CALENDARIO */
function generarCalendario(){
const calendar=document.getElementById("calendar");
calendar.innerHTML="";
const a√±o=fechaActual.getFullYear();
const mes=fechaActual.getMonth();
const dias=new Date(a√±o,mes+1,0).getDate();
document.getElementById("mesActual").textContent=
fechaActual.toLocaleString('es-ES',{month:'long',year:'numeric'});

for(let i=1;i<=dias;i++){
let fecha=`${a√±o}-${String(mes+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
let reservasDia=reservas.filter(r=>r.fecha===fecha).length;

let div=document.createElement("div");
div.textContent=i;
div.classList.add("day");

if(reservasDia===0){
div.classList.add("disponible-dia");
}else{
div.classList.add("parcial-dia");
}

if(sesion.rol==="cliente"){
div.onclick=()=>abrirAgenda(fecha);
}

calendar.appendChild(div);
}
}

function cambiarMes(valor){
fechaActual.setMonth(fechaActual.getMonth()+valor);
generarCalendario();
estadisticas();
}

/* AGENDA CLIENTE */
function abrirAgenda(fecha){
document.getElementById("clientePanel").classList.remove("hidden");
document.getElementById("clientePanel").innerHTML=`
<h3>Agendar para ${fecha}</h3>
<input type="text" id="nombreCliente" placeholder="Tu nombre">
<button onclick="mostrarHoras('${fecha}')">Ver Horas</button>
<div class="horas" id="horasContainer"></div>
`;
}

function mostrarHoras(fecha){
const horas=["10:00","11:00","12:00","14:00","15:00","16:00"];
const container=document.getElementById("horasContainer");
container.innerHTML="";
horas.forEach(hora=>{
let ocupado=reservas.find(r=>r.fecha===fecha&&r.hora===hora);
let btn=document.createElement("button");
btn.textContent=hora;
btn.classList.add("hora-btn");
if(ocupado){
btn.classList.add("ocupado");
btn.disabled=true;
}else{
btn.classList.add("disponible");
btn.onclick=()=>reservar(fecha,hora);
}
container.appendChild(btn);
});
}

function reservar(fecha,hora){
const nombre=document.getElementById("nombreCliente").value;
if(!nombre)return alert("Ingresa tu nombre");

reservas.push({
cliente:nombre,
fecha,
hora,
precio:precioBase
});

localStorage.setItem("reservas",JSON.stringify(reservas));
alert("Reserva confirmada üíÖ");
generarCalendario();
}

/* ADMIN */
function mostrarReservasAdmin(){
const lista=document.getElementById("listaAdmin");
lista.innerHTML="";
reservas.forEach((r,i)=>{
lista.innerHTML+=`
<li>${r.cliente} - ${r.fecha} ${r.hora} - $${r.precio}
<br><button class="admin-delete" onclick="eliminar(${i})">Eliminar</button></li>
`;
});
}

function eliminar(i){
reservas.splice(i,1);
localStorage.setItem("reservas",JSON.stringify(reservas));
mostrarReservasAdmin();
generarCalendario();
estadisticas();
}

/* ESTADISTICAS */
function estadisticas(){
const a√±o=fechaActual.getFullYear();
const mes=fechaActual.getMonth()+1;
let reservasMes=reservas.filter(r=>
r.fecha.startsWith(`${a√±o}-${String(mes).padStart(2,'0')}`)
);
let total=reservasMes.length;
let ingresos=reservasMes.reduce((acc,r)=>acc+r.precio,0);

document.getElementById("estadisticas").innerHTML=`
<div class="stat-box">Reservas: <strong>${total}</strong></div>
<div class="stat-box">Ingresos simulados: <strong>$${ingresos.toLocaleString()}</strong></div>
`;
}

/* EXPORTAR PDF */
function exportarPDF(){
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.text("Valentina Nails - Reservas",10,10);
let y=20;
reservas.forEach(r=>{
doc.text(`${r.cliente} - ${r.fecha} ${r.hora}`,10,y);
y+=10;
});
doc.save("reservas.pdf");
}

/* PWA */
if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
