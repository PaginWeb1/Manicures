<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manicure Pro | Agenda Mejorada</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',sans-serif;background:#fdf6f0;color:#222;}
header{background:#e91e63;color:white;padding:15px;text-align:center;font-size:22px;font-weight:700;}
.container{max-width:1100px;margin:auto;padding:20px;}
h2{text-align:center;margin:20px 0;color:#e91e63;}
button,input,select{padding:10px;border-radius:8px;border:1px solid #ccc;cursor:pointer;}
button{font-weight:600;}
.btn-primary{background:#ff4081;color:white;border:none;}
.btn-success{background:#16a34a;color:white;border:none;}
.btn-danger{background:#ef4444;color:white;border:none;}
.btn-warning{background:#f59e0b;color:white;border:none;}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-bottom:25px;}
.card{background:white;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);text-align:center;transition:0.3s;}
.card:hover{transform:translateY(-5px);}
.table-container{background:white;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1);overflow-x:auto;margin-bottom:25px;padding:10px;}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;}
.stock-bajo{background:#fee2e2;}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:20px;}
.day{padding:15px;border-radius:8px;text-align:center;font-weight:600;position:relative;cursor:pointer;}
.libre{background:#16a34a;color:white;}
.ocupado{background:#ef4444;color:white;}
.tooltip{position:absolute;background:rgba(0,0,0,0.8);color:white;padding:5px;border-radius:5px;font-size:12px;top:-35px;left:50%;transform:translateX(-50%);display:none;z-index:10;}
</style>
</head>
<body>

<header>Manicure Pro | Agenda Mejorada</header>
<div class="container">

<!-- DASHBOARD -->
<div class="dashboard">
<div class="card">Total Clientes<p id="totalClientes">0</p></div>
<div class="card">Total Productos<p id="totalProductos">0</p></div>
<div class="card">Valor Total Productos<p id="valorTotal">$0</p></div>
<div class="card">Total Ventas<p id="totalVentas">$0</p></div>
<div class="card">Reservas Hoy<p id="reservasHoy">0</p></div>
</div>

<!-- PRODUCTOS -->
<h2>Productos</h2>
<div class="form-grid">
<input type="text" id="nombre" placeholder="Nombre del producto">
<input type="number" id="cantidad" placeholder="Cantidad">
<input type="number" id="precio" placeholder="Precio">
<input type="number" id="stockMinimo" placeholder="Stock mínimo">
<button class="btn-primary" onclick="agregarProducto()">Agregar Producto</button>
</div>

<div class="table-container">
<h3>Productos</h3>
<table>
<thead><tr><th>ID</th><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Total</th><th>Acción</th></tr></thead>
<tbody id="tablaProductos"></tbody>
</table>
</div>

<!-- RESERVAS -->
<h2>Reservas</h2>
<div class="form-grid">
<input type="text" id="cliente" placeholder="Nombre Cliente">
<input type="date" id="fechaReserva">
<input type="time" id="horaReserva">
<button class="btn-success" onclick="agregarReserva()">Agregar Reserva</button>
<button class="btn-warning" onclick="exportarReservas()">Exportar Reservas</button>
</div>

<div class="calendar" id="calendario"></div>

<div class="table-container">
<h3>Reservas</h3>
<table>
<thead><tr><th>ID</th><th>Cliente</th><th>Fecha</th><th>Hora</th><th>Acción</th></tr></thead>
<tbody id="tablaReservas"></tbody>
</table>
</div>

<!-- VENTAS -->
<h2>Registrar Venta</h2>
<div class="form-grid">
<select id="productoVenta"></select>
<input type="number" id="cantidadVenta" placeholder="Cantidad">
<select id="planPago">
<option value="contado">Contado</option>
<option value="3x">3 Cuotas</option>
<option value="6x">6 Cuotas</option>
</select>
<button class="btn-warning" onclick="agregarVenta()">Registrar Venta</button>
</div>

<div class="table-container">
<h3>Ventas</h3>
<table>
<thead><tr><th>ID</th><th>Producto</th><th>Cantidad</th><th>Total</th><th>Plan Pago</th><th>Fecha</th></tr></thead>
<tbody id="tablaVentas"></tbody>
</table>
</div>

<!-- GRÁFICO VENTAS -->
<div class="table-container">
<h3>Gráfico de Ventas</h3>
<canvas id="graficoVentas"></canvas>
</div>

</div>

<script>
/* DATOS INICIALES */
let productos=JSON.parse(localStorage.getItem("productos"))||[];
let reservas=JSON.parse(localStorage.getItem("reservas"))||[];
let ventas=JSON.parse(localStorage.getItem("ventas"))||[];
let ultimoIdProducto=parseInt(localStorage.getItem("ultimoIdProducto"))||0;
let ultimoIdReserva=parseInt(localStorage.getItem("ultimoIdReserva"))||0;
let ultimoIdVenta=parseInt(localStorage.getItem("ultimoIdVenta"))||0;

/* FORMATO CLP */
function formatoCLP(v){return v.toLocaleString("es-CL",{style:"currency",currency:"CLP"});}
function guardar(){
localStorage.setItem("productos",JSON.stringify(productos));
localStorage.setItem("reservas",JSON.stringify(reservas));
localStorage.setItem("ventas",JSON.stringify(ventas));
localStorage.setItem("ultimoIdProducto",ultimoIdProducto);
localStorage.setItem("ultimoIdReserva",ultimoIdReserva);
localStorage.setItem("ultimoIdVenta",ultimoIdVenta);
}

/* PRODUCTOS */
function agregarProducto(){
let n=document.getElementById("nombre").value.trim();
let c=parseInt(document.getElementById("cantidad").value);
let p=parseFloat(document.getElementById("precio").value);
let s=parseInt(document.getElementById("stockMinimo").value)||0;
if(!n||isNaN(c)||isNaN(p)){alert("Complete los campos correctamente");return;}
productos.push({id:++ultimoIdProducto,nombre:n,cantidad:c,precio:p,stockMinimo:s});
document.querySelectorAll(".form-grid input").forEach(i=>i.value="");
guardar();mostrarProductos();actualizarSelect();
}
function mostrarProductos(){
const tabla=document.getElementById("tablaProductos");tabla.innerHTML="";let total=0,totalUnidades=0;
productos.forEach(p=>{let t=p.precio*p.cantidad;total+=t;totalUnidades+=p.cantidad;
let clase=p.cantidad<=p.stockMinimo?"stock-bajo":"";
tabla.innerHTML+=`<tr class="${clase}"><td>${p.id}</td><td>${p.nombre}</td><td>${p.cantidad}</td><td>${formatoCLP(p.precio)}</td><td>${formatoCLP(t)}</td>
<td><button class="btn-warning" onclick="editarProducto(${p.id})">Editar</button> <button class="btn-danger" onclick="eliminarProducto(${p.id})">Eliminar</button></td></tr>`;});
document.getElementById("totalProductos").innerText=productos.length;
document.getElementById("valorTotal").innerText=formatoCLP(total);
document.getElementById("totalUnidades").innerText=totalUnidades;
}
function editarProducto(id){
let p=productos.find(x=>x.id===id);if(!p)return;
let n=prompt("Nuevo nombre",p.nombre);
if(n){p.nombre=n;guardar();mostrarProductos();actualizarSelect();}
}
function eliminarProducto(id){productos=productos.filter(x=>x.id!==id);guardar();mostrarProductos();actualizarSelect();}

/* VENTAS */
function actualizarSelect(){
const sel=document.getElementById("productoVenta");sel.innerHTML="";
productos.forEach(p=>{sel.innerHTML+=`<option value="${p.id}">${p.nombre}</option>`;});}
actualizarSelect();
function agregarVenta(){
let pid=parseInt(document.getElementById("productoVenta").value);
let cant=parseInt(document.getElementById("cantidadVenta").value);
let plan=document.getElementById("planPago").value;
let p=productos.find(x=>x.id===pid);
if(!p||cant>p.cantidad){alert("Stock insuficiente");return;}
p.cantidad-=cant;
ventas.push({id:++ultimoIdVenta,producto:p.nombre,cantidad:cant,total:cant*p.precio,planPago:plan,fecha:new Date().toLocaleDateString()});
document.getElementById("cantidadVenta").value="";
guardar();mostrarProductos();mostrarVentas();actualizarGrafico();
}
function mostrarVentas(){const tabla=document.getElementById("tablaVentas");tabla.innerHTML="";let total=0;
ventas.forEach(v=>{total+=v.total;tabla.innerHTML+=`<tr><td>${v.id}</td><td>${v.producto}</td><td>${v.cantidad}</td><td>${formatoCLP(v.total)}</td><td>${v.planPago}</td><td>${v.fecha}</td></tr>`;});
document.getElementById("totalVentas").innerText=formatoCLP(total);
}

/* RESERVAS */
function agregarReserva(){
let c=document.getElementById("cliente").value.trim();
let f=document.getElementById("fechaReserva").value;
let h=document.getElementById("horaReserva").value;
if(!c||!f||!h){alert("Complete los campos");return;}
if(reservas.some(r=>r.fecha===f && r.hora===h)){alert("Hora ocupada");return;}
reservas.push({id:++ultimoIdReserva,cliente:c,fecha:f,hora:h});
document.getElementById("cliente").value="";document.getElementById("fechaReserva").value="";document.getElementById("horaReserva").value="";
guardar();mostrarReservas();actualizarCalendario();
}
function mostrarReservas(){
const tabla=document.getElementById("tablaReservas");tabla.innerHTML="";let hoy=new Date().toLocaleDateString();
let contHoy=0;
reservas.forEach(r=>{if(r.fecha===hoy)contHoy++;
tabla.innerHTML+=`<tr><td>${r.id}</td><td>${r.cliente}</td><td>${r.fecha}</td><td>${r.hora}</td><td><button class="btn-danger" onclick="eliminarReserva(${r.id})">Eliminar</button></td></tr>`;});
document.getElementById("reservasHoy").innerText=contHoy;
}
function eliminarReserva(id){reservas=reservas.filter(r=>r.id!==id);guardar();mostrarReservas();actualizarCalendario();}

/* CALENDARIO */
function actualizarCalendario(){
const cal=document.getElementById("calendario");cal.innerHTML="";
let hoy=new Date();
let diasMes=new Date(hoy.getFullYear(),hoy.getMonth()+1,0).getDate();
for(let d=1;d<=diasMes;d++){
let fecha=`${hoy.getFullYear()}-${String(hoy.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
let ocup=reservas.filter(r=>r.fecha===fecha);
let div=document.createElement("div");div.className="day "+(ocup.length>0?"ocupado":"libre");div.innerText=d;
if(ocup.length>0){
let tooltip=document.createElement("div");tooltip.className="tooltip";
tooltip.innerHTML=ocup.map(r=>`${r.cliente} - ${r.hora}`).join("<br>");
div.appendChild(tooltip);
div.onmouseover=()=>{tooltip.style.display="block";}
div.onmouseout=()=>{tooltip.style.display="none";}
div.onclick=()=>{if(confirm("Eliminar todas las reservas de este día?")){reservas=reservas.filter(r=>r.fecha!==fecha);guardar();mostrarReservas();actualizarCalendario();}}
}
cal.appendChild(div);
}}
actualizarCalendario();

/* EXPORTAR RESERVAS */
function exportarReservas(){
if(reservas.length===0){alert("No hay reservas");return;}
let csv="Cliente,Fecha,Hora\n";
reservas.forEach(r=>{csv+=`${r.cliente},${r.fecha},${r.hora}\n`;});
let blob=new Blob(["\uFEFF"+csv],{type:"text/csv;charset=utf-8;"});let url=URL.createObjectURL(blob);
let a=document.createElement("a");a.href=url;a.download=`reservas_${new Date().toLocaleDateString()}.csv`;a.click();
}

/* GRÁFICO VENTAS */
let ctx=document.getElementById("graficoVentas").getContext("2d");
let grafico=new Chart(ctx,{type:'bar',data:{labels:[],datasets:[{label:'Ventas',data:[],backgroundColor:'#ff4081'}]},options:{responsive:true,plugins:{legend:{display:false}}}});
function actualizarGrafico(){
let data={};ventas.forEach(v=>{data[v.producto]=(data[v.producto]||0)+v.total;});
grafico.data.labels=Object.keys(data);grafico.data.datasets[0].data=Object.values(data);grafico.update();
}
actualizarGrafico();
mostrarProductos();mostrarVentas();mostrarReservas();
</script>
</body>
</html>
